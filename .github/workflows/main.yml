name: Java CI with Maven

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '11'
        cache: 'maven'
    
    - name: Debug - Show complete structure
      run: |
        echo "=== Full project structure ==="
        find . -name "*.java" -type f | sort
        echo ""
        echo "=== src/main/java/tarea2/ ==="
        ls -la src/main/java/tarea2/ 2>/dev/null || echo "Directory doesn't exist"
        echo ""
        echo "=== Checking if Aeropuerto.java exists ==="
        find . -name "Aeropuerto.java" -type f
        echo ""
        echo "=== Checking if Avion.java exists ==="
        find . -name "Avion.java" -type f
    
    - name: Fix structure if needed
      run: |
        # Check if Java files are in wrong location
        if [ ! -d "src/main/java/tarea2" ]; then
          echo "Creating directory structure..."
          mkdir -p src/main/java/tarea2
          mkdir -p src/test/java/tarea2
        fi
        
        # Move any Java files from root to correct directory
        if [ -f "Aeropuerto.java" ]; then
          echo "Moving Aeropuerto.java to src/main/java/tarea2/"
          mv Aeropuerto.java src/main/java/tarea2/
        fi
        
        if [ -f "Avion.java" ]; then
          echo "Moving Avion.java to src/main/java/tarea2/"
          mv Avion.java src/main/java/tarea2/
        fi
        
        # Move all Java files from root
        mv *.java src/main/java/tarea2/ 2>/dev/null || true
    
    - name: Compile only main code first
      run: mvn compile -DskipTests
    
    - name: Run tests (skip compile to use existing)
      run: mvn test -DskipTests=false
    
    - name: Package application
      run: mvn package -DskipTests

name: Java CI with Maven

on:
  push:
    branches: ["pruebas_unitarias", "main"]  # Ejecutar en ambas ramas
  pull_request:
    branches: ["pruebas_unitarias", "main"]
  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        ref: pruebas_unitarias  # Especificar rama a usar

    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '11'
        cache: 'maven'
    
    - name: Verify project structure
      run: |
        echo "=== Project structure ==="
        find . -name "*.java" -type f | sort
        echo ""
        echo "=== Main classes ==="
        ls -la src/main/java/tarea2/*.java 2>/dev/null || echo "No main Java files"
        echo ""
        echo "=== Checking ProduccionAeronaves.java ==="
        if [ -f "src/main/java/tarea2/ProduccionAeronaves.java" ]; then
          echo "✓ Found ProduccionAeronaves.java"
          head -20 src/main/java/tarea2/ProduccionAeronaves.java
        else
          echo "✗ ERROR: ProduccionAeronaves.java not found!"
          exit 1
        fi
    
    - name: Build with Maven
      run: mvn clean compile
    
    - name: Run unit tests
      run: mvn test
    
    - name: Run application
      run: |
        echo "=== Running application ==="
        java -cp target/classes tarea2.ProduccionAeronaves
